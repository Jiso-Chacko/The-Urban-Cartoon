<div class="main-panel">
    <div class="content-wrapper">

        <div class="page-header">

            <h3 class="page-title">
                <span class="page-title-icon bg-gradient-primary text-white mr-2">
                    <i class="mdi mdi-home"></i>
                </span> Dashboard
            </h3>

        </div>
        <div class="row">
            <div class="col-md-4 stretch-card grid-margin">
                <div class="card bg-gradient-danger card-img-holder text-white">
                    <div class="card-body">
                        <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />

                        <h4 class="font-weight-normal mb-3">Total orders <i
                                class="mdi mdi-chart-line mdi-24px float-right"></i>
                        </h4>
                        <h2 class="mb-5">{{orders}}</h2>

                    </div>
                </div>
            </div>
            <div class="col-md-4 stretch-card grid-margin">
                <div class="card bg-gradient-info card-img-holder text-white">
                    <div class="card-body">
                        <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
                        <h4 class="font-weight-normal mb-3">Total Sales <i
                                class="mdi mdi-bookmark-outline mdi-24px float-right"></i>
                        </h4>
                        <h2 class="mb-5">₹ {{totalSales}}</h2>

                    </div>
                </div>
            </div>
            <div class="col-md-4 stretch-card grid-margin">
                <div class="card bg-gradient-success card-img-holder text-white">
                    <div class="card-body">
                        <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
                        <h4 class="font-weight-normal mb-3">Total Profit<i
                                class="mdi mdi-diamond mdi-24px float-right"></i>
                        </h4>
                        <h2 class="mb-5">₹ {{totalProfit}}</h2>

                    </div>
                </div>
            </div>
            <div class="col-md-4 stretch-card grid-margin">
                <div class="card bg-gradient-primary card-img-holder text-white">
                    <div class="card-body">
                        <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image" />
                        <h4 class="font-weight-normal mb-3">Total users<i
                                class="mdi mdi-account mdi-24px float-right"></i>
                        </h4>
                        <h2 class="mb-5">{{totalUsers}}</h2>

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-7 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="clearfix">
                            <h4 class="card-title float-left">Sales Statistics</h4>
                            <div id="visit-sale-chart-legend"
                                class="rounded-legend legend-horizontal legend-top-right float-right"></div>
                            <div class="percent-chart">
                                <canvas id="myChart" style="max-width: 500px;"></canvas>
                            </div>
                        </div>


                    </div>
                </div>
            </div>


            <div class="col-md-5 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Brands in high demand</h4>
                        <canvas id="doughnutChart"></canvas>
                        <div id="traffic-chart-legend" class="rounded-legend legend-vertical legend-bottom-left pt-4">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{!-- <div class="row">
            <div class="col-md-7 grid-margin stretch-card">
                <div class="card">                 
                  <div class="card-body">

                    <h4 class="card-title">Top selling products</h4>

                     <canvas id="horizontalBar"></canvas>


                  </div>
                </div>
              </div>
        </div> --}}

        <div class="row">
            <div class="col-md-10 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="clearfix">
                            <h4 class="card-title float-left">Top selling products</h4>
                            <div id="visit-sale-chart-legend"
                                class="rounded-legend legend-horizontal legend-top-right float-right"></div>
                            <div class="percent-chart">
                     <canvas id="horizontalBar" style="max-width: 100%;"></canvas>
                            </div>
                        </div>


                    </div>
                </div>
            </div>


    </div>

     <div class="row">
              <div class="col-12 grid-margin">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">Recent Orders</h4>
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th> Image </th>
                            <th> Product </th>
                            <th> Status </th>
                            <th> Order date </th>
                            <th> Order ID </th>
                          </tr>
                        </thead>
                        <tbody>
                        {{#each order4Dashboard}}
                        {{#each products}}
                          <tr>
                            <td>
                              <img src="/productimages/{{#each this.productDetails}}{{this.imageName.[0]}}{{/each}}" class="mr-2" alt="image">  
                            </td>
                            <td>{{#each this.productDetails}}{{this.productName}}{{/each}}</td>
                            <td>
                                {{#if this.placed}}
                              <label class="badge badge-gradient-info">Placed</label>
                              {{/if}}
                              {{#if this.shipped}}
                              <label class="badge badge-gradient-warning">Shipped</label>
                              {{/if}}
                              {{#if this.delivered}}
                              <label class="badge badge-gradient-success">Delivered</label>
                              {{/if}}

                              {{#if this.cancelled}}
                              <label class="badge badge-gradient-danger">Cancelled</label>
                              {{/if}}
                            </td>
                            <td>{{../this.date}}</td>
                            <td>{{../this._id}}</td>
                          </tr>
                          {{/each}}
                        {{/each}}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <!-- AREA CHART -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Monthly Report</h3>
                <ul class="legend">
                    <li><span class="smartPhone"></span>Smart phone</li>
                    <li><span class="laptop"></span>Laptop</li>
                </ul>

                <div class="card-tools">
                 
                </div>
              </div>
              <div class="card-body">
                <div class="chart">
                  <canvas id="areaChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
              </div>
              <!-- /.card-body -->
            </div>

                </div>

            </div>


</div>

<style>
    /* basic positioning */
.legend { list-style: none; }
.legend li { float: left; margin-right: 2rem; line-height: 1 !important}
.legend span { border: 1px solid #ccc; float: left; width: 12px; height: 12px; margin: 2px;; }
/* your colors */
.legend .smartPhone { background-color: rgba(60,141,188,0.9); }
.legend .laptop { background-color: rgba(210, 214, 222, 1); }
</style>

<!-- content-wrapper ends -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/dist/js/adminlte.min.js"></script>


<script>
    var ctx = document.getElementById("myChart").getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["Smart Phone", "Laptop"],
            datasets: [{
                label: 'Smart Phone',
                data: [{{smartPhoneCount}},{{laptopCount}}],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    //doughnut

    let brands = '{{brands}}';
    brands = brands.split(',')
    console.log(brands)
    let brandCount = '{{brandCount}}'
    brandCount = brandCount.split(',')
    console.log(brandCount)
    var ctxD = document.getElementById("doughnutChart").getContext('2d');
    var myLineChart = new Chart(ctxD, {
    type: 'doughnut',
    data: {
    labels: brands,
    datasets: [{
    data: brandCount,
    backgroundColor: ["#F7464A", "#46BFBD", "#FDB45C", "#949FB1", "#4D5360"],
    hoverBackgroundColor: ["#FF5A5E", "#5AD3D1", "#FFC870", "#A8B3C5", "#616774"]
    }]
    },
    options: {
    responsive: true
    }
    });

        let products = '{{products}}';
    products = products.split(',')
    console.log(products)
    let productsSale = '{{productsSale}}'
    productsSale = productsSale.split(',')
    let count = []
    for(let i=0;i<productsSale.length;i++){
         count.push(parseInt(productsSale[i]))
    }
    console.log(count)

       var ctx = document.getElementById("horizontalBar").getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: products,
            datasets: [{
                label: 'Top selling products',
                data: count,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>

<script>
    $(() => {
        console.log("This is smartphone count")
      

        /* ChartJS
     * -------
     * Here we will create a few charts using ChartJS
     */

    //--------------
    //- AREA CHART -
    //--------------

    // Get context with jQuery - using jQuery's .get() method.
    var areaChartCanvas = $('#areaChart').get(0).getContext('2d')

    var areaChartData = {
      labels  : ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
      datasets: [
        {
          label               : 'Smart Phone',
          backgroundColor     : 'rgba(60,141,188,0.9)',
          borderColor         : 'rgba(60,141,188,0.8)',
          pointRadius          : true,
          pointColor          : '#3b8bba',
          pointStrokeColor    : 'rgba(60,141,188,1)',
          pointHighlightFill  : '#fff',
          pointHighlightStroke: 'rgba(60,141,188,1)',
          data                : [4, 6, 0, 0, 0, 0, 0]
        },
        {
          label               : 'Laptop',
          backgroundColor     : 'rgba(210, 214, 222, 1)',
          borderColor         : 'rgba(210, 214, 222, 1)',
          pointRadius         : true,
          pointColor          : 'rgba(210, 214, 222, 1)',
          pointStrokeColor    : '#c1c7d1',
          pointHighlightFill  : '#fff',
          pointHighlightStroke: 'rgba(220,220,220,1)',
          data                : [6, 10, 0, 0, 0, 0, 0]
        },
      ]
    }

    var areaChartOptions = {
      maintainAspectRatio : false,
      responsive : true,
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          gridLines : {
            display : false,
          }
        }],
        yAxes: [{
          gridLines : {
            display : false,
          }
        }]
      }
    }

    // This will get the first returned node in the jQuery collection.
    new Chart(areaChartCanvas, {
      type: 'line',
      data: areaChartData,
      options: areaChartOptions
    })
    })

</script>
